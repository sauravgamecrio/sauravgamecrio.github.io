/*!
 * @pixi/compressed-textures - v6.0.2
 * Compiled Mon, 05 Apr 2021 18:17:46 UTC
 *
 * @pixi/compressed-textures is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _a,core=require("@pixi/core"),loaders=require("@pixi/loaders"),constants=require("@pixi/constants");!function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL"}(exports.INTERNAL_FORMATS||(exports.INTERNAL_FORMATS={}));var INTERNAL_FORMAT_TO_BYTES_PER_PIXEL=((_a={})[exports.INTERNAL_FORMATS.COMPRESSED_RGB_S3TC_DXT1_EXT]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT]=1,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT]=1,_a[exports.INTERNAL_FORMATS.COMPRESSED_SRGB_S3TC_DXT1_EXT]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]=1,_a[exports.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]=1,_a[exports.INTERNAL_FORMATS.COMPRESSED_R11_EAC]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_SIGNED_R11_EAC]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_RG11_EAC]=1,_a[exports.INTERNAL_FORMATS.COMPRESSED_SIGNED_RG11_EAC]=1,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGB8_ETC2]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGBA8_ETC2_EAC]=1,_a[exports.INTERNAL_FORMATS.COMPRESSED_SRGB8_ETC2]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]=1,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=.25,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=.25,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGB_ETC1_WEBGL]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGB_ATC_WEBGL]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]=1,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]=1,_a),extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var _ in t)t.hasOwnProperty(_)&&(e[_]=t[_])})(e,t)};function __extends(e,t){function _(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(_.prototype=t.prototype,new _)}function __awaiter(e,t,_,r){return new(_||(_=Promise))(function(n,o){function s(e){try{R(r.next(e))}catch(e){o(e)}}function a(e){try{R(r.throw(e))}catch(e){o(e)}}function R(e){e.done?n(e.value):new _(function(t){t(e.value)}).then(s,a)}R((r=r.apply(e,t||[])).next())})}function __generator(e,t){var _,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(_)throw new TypeError("Generator is already executing.");for(;s;)try{if(_=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{_=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var BlobResource=function(e){function t(t,_){void 0===_&&(_={width:1,height:1,autoLoad:!0});var r,n,o=this;return"string"==typeof t?(r=t,n=new Uint8Array):(r=null,n=t),(o=e.call(this,n,_)||this).origin=r,o.buffer=n?new core.ViewableBuffer(n):null,o.origin&&!1!==_.autoLoad&&o.load(),n&&n.length&&(o.loaded=!0,o.onBlobLoaded(o.buffer.rawBinaryData)),o}return __extends(t,e),t.prototype.onBlobLoaded=function(e){},t.prototype.load=function(){return __awaiter(this,void 0,Promise,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,fetch(this.origin)];case 1:return[4,t.sent().blob()];case 2:return[4,t.sent().arrayBuffer()];case 3:return e=t.sent(),this.data=new Uint32Array(e),this.buffer=new core.ViewableBuffer(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),[2,this]}})})},t}(core.BufferResource),CompressedTextureResource=function(e){function t(_,r){var n=e.call(this,_,r)||this;return n.format=r.format,n.levels=r.levels||1,n._width=r.width,n._height=r.height,n._extension=t._formatToExtension(n.format),(r.levelBuffers||n.buffer)&&(n._levelBuffers=r.levelBuffers||t._createLevelBuffers(_ instanceof Uint8Array?_:n.buffer.uint8View,n.format,n.levels,4,4,n.width,n.height)),n}return __extends(t,e),t.prototype.upload=function(e,t,_){var r=e.gl;if(!e.context.extensions[this._extension])throw new Error(this._extension+" textures are not supported on the current machine");if(!this._levelBuffers)return!1;for(var n=0,o=this.levels;n<o;n++){var s=this._levelBuffers[n],a=s.levelID,R=s.levelWidth,i=s.levelHeight,T=s.levelBuffer;r.compressedTexImage2D(r.TEXTURE_2D,a,this.format,R,i,0,T)}return!0},t.prototype.onBlobLoaded=function(){this._levelBuffers=t._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)},t._formatToExtension=function(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(e>=36196)return"etc1";if(e>=35986&&e<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")},t._createLevelBuffers=function(e,t,_,r,n,o,s){for(var a=new Array(_),R=e.byteOffset,i=o,T=s,E=i+r-1&~(r-1),A=T+n-1&~(n-1),O=E*A*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[t],S=0;S<_;S++)a[S]={levelID:S,levelWidth:_>1?i:E,levelHeight:_>1?T:A,levelBuffer:new Uint8Array(e.buffer,R,O)},R+=O,O=(E=(i=i>>1||1)+r-1&~(r-1))*(A=(T=T>>1||1)+n-1&~(n-1))*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[t];return a},t}(BlobResource),appleIphone=/iPhone/i,appleIpod=/iPod/i,appleTablet=/iPad/i,appleUniversal=/\biOS-universal(?:.+)Mac\b/i,androidPhone=/\bAndroid(?:.+)Mobile\b/i,androidTablet=/Android/i,amazonPhone=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,amazonTablet=/Silk/i,windowsPhone=/Windows Phone/i,windowsTablet=/\bWindows(?:.+)ARM\b/i,otherBlackBerry=/BlackBerry/i,otherBlackBerry10=/BB10/i,otherOpera=/Opera Mini/i,otherChrome=/\b(CriOS|Chrome)(?:.+)Mobile/i,otherFirefox=/Mobile(?:.+)Firefox\b/i,isAppleTabletOnIos13=function(e){return void 0!==e&&"MacIntel"===e.platform&&"number"==typeof e.maxTouchPoints&&e.maxTouchPoints>1&&"undefined"==typeof MSStream};function createMatch(e){return function(t){return t.test(e)}}function isMobile(e){var t={userAgent:"",platform:"",maxTouchPoints:0};e||"undefined"==typeof navigator?"string"==typeof e?t.userAgent=e:e&&e.userAgent&&(t={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0}):t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var _=t.userAgent,r=_.split("[FBAN");void 0!==r[1]&&(_=r[0]),void 0!==(r=_.split("Twitter"))[1]&&(_=r[0]);var n=createMatch(_),o={apple:{phone:n(appleIphone)&&!n(windowsPhone),ipod:n(appleIpod),tablet:!n(appleIphone)&&(n(appleTablet)||isAppleTabletOnIos13(t))&&!n(windowsPhone),universal:n(appleUniversal),device:(n(appleIphone)||n(appleIpod)||n(appleTablet)||n(appleUniversal)||isAppleTabletOnIos13(t))&&!n(windowsPhone)},amazon:{phone:n(amazonPhone),tablet:!n(amazonPhone)&&n(amazonTablet),device:n(amazonPhone)||n(amazonTablet)},android:{phone:!n(windowsPhone)&&n(amazonPhone)||!n(windowsPhone)&&n(androidPhone),tablet:!n(windowsPhone)&&!n(amazonPhone)&&!n(androidPhone)&&(n(amazonTablet)||n(androidTablet)),device:!n(windowsPhone)&&(n(amazonPhone)||n(amazonTablet)||n(androidPhone)||n(androidTablet))||n(/\bokhttp\b/i)},windows:{phone:n(windowsPhone),tablet:n(windowsTablet),device:n(windowsPhone)||n(windowsTablet)},other:{blackberry:n(otherBlackBerry),blackberry10:n(otherBlackBerry10),opera:n(otherOpera),firefox:n(otherFirefox),chrome:n(otherChrome),device:n(otherBlackBerry)||n(otherBlackBerry10)||n(otherOpera)||n(otherFirefox)||n(otherChrome)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}var isMobile$1=isMobile(self.navigator);function maxRecommendedTextures(e){var t=!0;if(isMobile$1.tablet||isMobile$1.phone){var _;if(isMobile$1.apple.device)if(_=navigator.userAgent.match(/OS (\d+)_(\d+)?/))parseInt(_[1],10)<11&&(t=!1);if(isMobile$1.android.device)if(_=navigator.userAgent.match(/Android\s([0-9.]*)/))parseInt(_[1],10)<7&&(t=!1)}return t?e:4}function canUploadSameBuffer(){return!isMobile$1.apple.device}var settings={MIPMAP_TEXTURES:1,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:maxRecommendedTextures(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:33071,SCALE_MODE:1,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:isMobile$1.apple.device?"highp":"mediump",CAN_UPLOAD_SAME_BUFFER:canUploadSameBuffer(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t,_){return e(_={path:t,exports:{},require:function(e,t){return commonjsRequire(e,null==t?_.path:t)}},_.exports),_.exports}function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var eventemitter3=createCommonjsModule(function(e){var t=Object.prototype.hasOwnProperty,_="~";function r(){}function n(e,t,_){this.fn=e,this.context=t,this.once=_||!1}function o(e,t,r,o,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new n(r,o||e,s),R=_?_+t:t;return e._events[R]?e._events[R].fn?e._events[R]=[e._events[R],a]:e._events[R].push(a):(e._events[R]=a,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(_=!1)),a.prototype.eventNames=function(){var e,r,n=[];if(0===this._eventsCount)return n;for(r in e=this._events)t.call(e,r)&&n.push(_?r.slice(1):r);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},a.prototype.listeners=function(e){var t=_?_+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,o=r.length,s=new Array(o);n<o;n++)s[n]=r[n].fn;return s},a.prototype.listenerCount=function(e){var t=_?_+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,n,o,s){var a=arguments,R=_?_+e:e;if(!this._events[R])return!1;var i,T,E=this._events[R],A=arguments.length;if(E.fn){switch(E.once&&this.removeListener(e,E.fn,void 0,!0),A){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,t),!0;case 3:return E.fn.call(E.context,t,r),!0;case 4:return E.fn.call(E.context,t,r,n),!0;case 5:return E.fn.call(E.context,t,r,n,o),!0;case 6:return E.fn.call(E.context,t,r,n,o,s),!0}for(T=1,i=new Array(A-1);T<A;T++)i[T-1]=a[T];E.fn.apply(E.context,i)}else{var O,S=E.length;for(T=0;T<S;T++)switch(E[T].once&&this.removeListener(e,E[T].fn,void 0,!0),A){case 1:E[T].fn.call(E[T].context);break;case 2:E[T].fn.call(E[T].context,t);break;case 3:E[T].fn.call(E[T].context,t,r);break;case 4:E[T].fn.call(E[T].context,t,r,n);break;default:if(!i)for(O=1,i=new Array(A-1);O<A;O++)i[O-1]=a[O];E[T].fn.apply(E[T].context,i)}}return!0},a.prototype.on=function(e,t,_){return o(this,e,t,_,!1)},a.prototype.once=function(e,t,_){return o(this,e,t,_,!0)},a.prototype.removeListener=function(e,t,r,n){var o=_?_+e:e;if(!this._events[o])return this;if(!t)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||n&&!a.once||r&&a.context!==r||s(this,o);else{for(var R=0,i=[],T=a.length;R<T;R++)(a[R].fn!==t||n&&!a[R].once||r&&a[R].context!==r)&&i.push(a[R]);i.length?this._events[o]=1===i.length?i[0]:i:s(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=_?_+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=_,a.EventEmitter=a,e.exports=a}),punycode=createCommonjsModule(function(e,t){!function(_){var r=t&&!t.nodeType&&t,n=e&&!e.nodeType&&e,o="object"==typeof commonjsGlobal&&commonjsGlobal;o.global!==o&&o.window!==o&&o.self!==o||(_=o);var s,a,R=2147483647,i=36,T=1,E=26,A=38,O=700,S=72,h=128,D="-",M=/^xn--/,l=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,I={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},c=i-T,G=Math.floor,p=String.fromCharCode;function f(e){throw RangeError(I[e])}function F(e,t){for(var _=e.length,r=[];_--;)r[_]=t(e[_]);return r}function P(e,t){var _=e.split("@"),r="";return _.length>1&&(r=_[0]+"@",e=_[1]),r+F((e=e.replace(u,".")).split("."),t).join(".")}function X(e){for(var t,_,r=[],n=0,o=e.length;n<o;)(t=e.charCodeAt(n++))>=55296&&t<=56319&&n<o?56320==(64512&(_=e.charCodeAt(n++)))?r.push(((1023&t)<<10)+(1023&_)+65536):(r.push(t),n--):r.push(t);return r}function N(e){return F(e,function(e){var t="";return e>65535&&(t+=p((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=p(e)}).join("")}function C(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function d(e,t,_){var r=0;for(e=_?G(e/O):e>>1,e+=G(e/t);e>c*E>>1;r+=i)e=G(e/c);return G(r+(c+1)*e/(e+A))}function B(e){var t,_,r,n,o,s,a,A,O,M,l,u=[],I=e.length,c=0,p=h,F=S;for((_=e.lastIndexOf(D))<0&&(_=0),r=0;r<_;++r)e.charCodeAt(r)>=128&&f("not-basic"),u.push(e.charCodeAt(r));for(n=_>0?_+1:0;n<I;){for(o=c,s=1,a=i;n>=I&&f("invalid-input"),((A=(l=e.charCodeAt(n++))-48<10?l-22:l-65<26?l-65:l-97<26?l-97:i)>=i||A>G((R-c)/s))&&f("overflow"),c+=A*s,!(A<(O=a<=F?T:a>=F+E?E:a-F));a+=i)s>G(R/(M=i-O))&&f("overflow"),s*=M;F=d(c-o,t=u.length+1,0==o),G(c/t)>R-p&&f("overflow"),p+=G(c/t),c%=t,u.splice(c++,0,p)}return N(u)}function L(e){var t,_,r,n,o,s,a,A,O,M,l,u,I,c,F,P=[];for(u=(e=X(e)).length,t=h,_=0,o=S,s=0;s<u;++s)(l=e[s])<128&&P.push(p(l));for(r=n=P.length,n&&P.push(D);r<u;){for(a=R,s=0;s<u;++s)(l=e[s])>=t&&l<a&&(a=l);for(a-t>G((R-_)/(I=r+1))&&f("overflow"),_+=(a-t)*I,t=a,s=0;s<u;++s)if((l=e[s])<t&&++_>R&&f("overflow"),l==t){for(A=_,O=i;!(A<(M=O<=o?T:O>=o+E?E:O-o));O+=i)F=A-M,c=i-M,P.push(p(C(M+F%c,0))),A=G(F/c);P.push(p(C(A,0))),o=d(_,I,r==n),_=0,++r}++_,++t}return P.join("")}if(s={version:"1.3.2",ucs2:{decode:X,encode:N},decode:B,encode:L,toASCII:function(e){return P(e,function(e){return l.test(e)?"xn--"+L(e):e})},toUnicode:function(e){return P(e,function(e){return M.test(e)?B(e.slice(4).toLowerCase()):e})}},r&&n)if(e.exports==r)n.exports=s;else for(a in s)s.hasOwnProperty(a)&&(r[a]=s[a]);else _.punycode=s}(commonjsGlobal)}),util={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}};function hasOwnProperty(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var decode=function(e,t,_,r){t=t||"&",_=_||"=";var n={};if("string"!=typeof e||0===e.length)return n;var o=/\+/g;e=e.split(t);var s=1e3;r&&"number"==typeof r.maxKeys&&(s=r.maxKeys);var a=e.length;s>0&&a>s&&(a=s);for(var R=0;R<a;++R){var i,T,E,A,O=e[R].replace(o,"%20"),S=O.indexOf(_);S>=0?(i=O.substr(0,S),T=O.substr(S+1)):(i=O,T=""),E=decodeURIComponent(i),A=decodeURIComponent(T),hasOwnProperty(n,E)?Array.isArray(n[E])?n[E].push(A):n[E]=[n[E],A]:n[E]=A}return n},stringifyPrimitive=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},encode=function(e,t,_,r){return t=t||"&",_=_||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map(function(r){var n=encodeURIComponent(stringifyPrimitive(r))+_;return Array.isArray(e[r])?e[r].map(function(e){return n+encodeURIComponent(stringifyPrimitive(e))}).join(t):n+encodeURIComponent(stringifyPrimitive(e[r]))}).join(t):r?encodeURIComponent(stringifyPrimitive(r))+_+encodeURIComponent(stringifyPrimitive(e)):""},querystring=createCommonjsModule(function(e,t){t.decode=t.parse=decode,t.encode=t.stringify=encode}),parse=urlParse,resolve=urlResolve,format=urlFormat;function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r","\n","\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function urlParse(e,t,_){if(e&&util.isObject(e)&&e instanceof Url)return e;var r=new Url;return r.parse(e,t,_),r}function urlFormat(e){return util.isString(e)&&(e=urlParse(e)),e instanceof Url?e.format():Url.prototype.format.call(e)}function urlResolve(e,t){return urlParse(e,!1,!0).resolve(t)}Url.prototype.parse=function(e,t,_){if(!util.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),n=-1!==r&&r<e.indexOf("#")?"?":"#",o=e.split(n);o[0]=o[0].replace(/\\/g,"/");var s=e=o.join(n);if(s=s.trim(),!_&&1===e.split("#").length){var a=simplePathPattern.exec(s);if(a)return this.path=s,this.href=s,this.pathname=a[1],a[2]?(this.search=a[2],this.query=t?querystring.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var R=protocolPattern.exec(s);if(R){var i=(R=R[0]).toLowerCase();this.protocol=i,s=s.substr(R.length)}if(_||R||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var T="//"===s.substr(0,2);!T||R&&hostlessProtocol[R]||(s=s.substr(2),this.slashes=!0)}if(!hostlessProtocol[R]&&(T||R&&!slashedProtocol[R])){for(var E,A,O=-1,S=0;S<hostEndingChars.length;S++){-1!==(h=s.indexOf(hostEndingChars[S]))&&(-1===O||h<O)&&(O=h)}-1!==(A=-1===O?s.lastIndexOf("@"):s.lastIndexOf("@",O))&&(E=s.slice(0,A),s=s.slice(A+1),this.auth=decodeURIComponent(E)),O=-1;for(S=0;S<nonHostChars.length;S++){var h;-1!==(h=s.indexOf(nonHostChars[S]))&&(-1===O||h<O)&&(O=h)}-1===O&&(O=s.length),this.host=s.slice(0,O),s=s.slice(O),this.parseHost(),this.hostname=this.hostname||"";var D="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!D)for(var M=this.hostname.split(/\./),l=(S=0,M.length);S<l;S++){var u=M[S];if(u&&!u.match(hostnamePartPattern)){for(var I="",c=0,G=u.length;c<G;c++)u.charCodeAt(c)>127?I+="x":I+=u[c];if(!I.match(hostnamePartPattern)){var p=M.slice(0,S),f=M.slice(S+1),F=u.match(hostnamePartStart);F&&(p.push(F[1]),f.unshift(F[2])),f.length&&(s="/"+f.join(".")+s),this.hostname=p.join(".");break}}}this.hostname.length>hostnameMaxLen?this.hostname="":this.hostname=this.hostname.toLowerCase(),D||(this.hostname=punycode.toASCII(this.hostname));var P=this.port?":"+this.port:"",X=this.hostname||"";this.host=X+P,this.href+=this.host,D&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!unsafeProtocol[i])for(S=0,l=autoEscape.length;S<l;S++){var N=autoEscape[S];if(-1!==s.indexOf(N)){var C=encodeURIComponent(N);C===N&&(C=escape(N)),s=s.split(N).join(C)}}var d=s.indexOf("#");-1!==d&&(this.hash=s.substr(d),s=s.slice(0,d));var B=s.indexOf("?");if(-1!==B?(this.search=s.substr(B),this.query=s.substr(B+1),t&&(this.query=querystring.parse(this.query)),s=s.slice(0,B)):t&&(this.search="",this.query={}),s&&(this.pathname=s),slashedProtocol[i]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){P=this.pathname||"";var L=this.search||"";this.path=P+L}return this.href=this.format(),this},Url.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",_=this.pathname||"",r=this.hash||"",n=!1,o="";this.host?n=e+this.host:this.hostname&&(n=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&util.isObject(this.query)&&Object.keys(this.query).length&&(o=querystring.stringify(this.query));var s=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||slashedProtocol[t])&&!1!==n?(n="//"+(n||""),_&&"/"!==_.charAt(0)&&(_="/"+_)):n||(n=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),t+n+(_=_.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(s=s.replace("#","%23"))+r},Url.prototype.resolve=function(e){return this.resolveObject(urlParse(e,!1,!0)).format()},Url.prototype.resolveObject=function(e){if(util.isString(e)){var t=new Url;t.parse(e,!1,!0),e=t}for(var _=new Url,r=Object.keys(this),n=0;n<r.length;n++){var o=r[n];_[o]=this[o]}if(_.hash=e.hash,""===e.href)return _.href=_.format(),_;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),a=0;a<s.length;a++){var R=s[a];"protocol"!==R&&(_[R]=e[R])}return slashedProtocol[_.protocol]&&_.hostname&&!_.pathname&&(_.path=_.pathname="/"),_.href=_.format(),_}if(e.protocol&&e.protocol!==_.protocol){if(!slashedProtocol[e.protocol]){for(var i=Object.keys(e),T=0;T<i.length;T++){var E=i[T];_[E]=e[E]}return _.href=_.format(),_}if(_.protocol=e.protocol,e.host||hostlessProtocol[e.protocol])_.pathname=e.pathname;else{for(var A=(e.pathname||"").split("/");A.length&&!(e.host=A.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==A[0]&&A.unshift(""),A.length<2&&A.unshift(""),_.pathname=A.join("/")}if(_.search=e.search,_.query=e.query,_.host=e.host||"",_.auth=e.auth,_.hostname=e.hostname||e.host,_.port=e.port,_.pathname||_.search){var O=_.pathname||"",S=_.search||"";_.path=O+S}return _.slashes=_.slashes||e.slashes,_.href=_.format(),_}var h=_.pathname&&"/"===_.pathname.charAt(0),D=e.host||e.pathname&&"/"===e.pathname.charAt(0),M=D||h||_.host&&e.pathname,l=M,u=_.pathname&&_.pathname.split("/")||[],I=(A=e.pathname&&e.pathname.split("/")||[],_.protocol&&!slashedProtocol[_.protocol]);if(I&&(_.hostname="",_.port=null,_.host&&(""===u[0]?u[0]=_.host:u.unshift(_.host)),_.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===A[0]?A[0]=e.host:A.unshift(e.host)),e.host=null),M=M&&(""===A[0]||""===u[0])),D)_.host=e.host||""===e.host?e.host:_.host,_.hostname=e.hostname||""===e.hostname?e.hostname:_.hostname,_.search=e.search,_.query=e.query,u=A;else if(A.length)u||(u=[]),u.pop(),u=u.concat(A),_.search=e.search,_.query=e.query;else if(!util.isNullOrUndefined(e.search)){if(I)_.hostname=_.host=u.shift(),(F=!!(_.host&&_.host.indexOf("@")>0)&&_.host.split("@"))&&(_.auth=F.shift(),_.host=_.hostname=F.shift());return _.search=e.search,_.query=e.query,util.isNull(_.pathname)&&util.isNull(_.search)||(_.path=(_.pathname?_.pathname:"")+(_.search?_.search:"")),_.href=_.format(),_}if(!u.length)return _.pathname=null,_.search?_.path="/"+_.search:_.path=null,_.href=_.format(),_;for(var c=u.slice(-1)[0],G=(_.host||e.host||u.length>1)&&("."===c||".."===c)||""===c,p=0,f=u.length;f>=0;f--)"."===(c=u[f])?u.splice(f,1):".."===c?(u.splice(f,1),p++):p&&(u.splice(f,1),p--);if(!M&&!l)for(;p--;p)u.unshift("..");!M||""===u[0]||u[0]&&"/"===u[0].charAt(0)||u.unshift(""),G&&"/"!==u.join("/").substr(-1)&&u.push("");var F,P=""===u[0]||u[0]&&"/"===u[0].charAt(0);I&&(_.hostname=_.host=P?"":u.length?u.shift():"",(F=!!(_.host&&_.host.indexOf("@")>0)&&_.host.split("@"))&&(_.auth=F.shift(),_.host=_.hostname=F.shift()));return(M=M||_.host&&u.length)&&!P&&u.unshift(""),u.length?_.pathname=u.join("/"):(_.pathname=null,_.path=null),util.isNull(_.pathname)&&util.isNull(_.search)||(_.path=(_.pathname?_.pathname:"")+(_.search?_.search:"")),_.auth=e.auth||_.auth,_.slashes=_.slashes||e.slashes,_.href=_.format(),_},Url.prototype.parseHost=function(){var e=this.host,t=portPattern.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)};var url={parse:parse,format:format,resolve:resolve};function mapPremultipliedBlendModes(){for(var e=[],t=[],_=0;_<32;_++)e[_]=_,t[_]=_;e[constants.BLEND_MODES.NORMAL_NPM]=constants.BLEND_MODES.NORMAL,e[constants.BLEND_MODES.ADD_NPM]=constants.BLEND_MODES.ADD,e[constants.BLEND_MODES.SCREEN_NPM]=constants.BLEND_MODES.SCREEN,t[constants.BLEND_MODES.NORMAL]=constants.BLEND_MODES.NORMAL_NPM,t[constants.BLEND_MODES.ADD]=constants.BLEND_MODES.ADD_NPM,t[constants.BLEND_MODES.SCREEN]=constants.BLEND_MODES.SCREEN_NPM;var r=[];return r.push(t),r.push(e),r}settings.RETINA_PREFIX=/@([0-9\.]+)x/,settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var _a$1,_b,premultiplyBlendMode=mapPremultipliedBlendModes(),CanvasRenderTarget=function(){function e(e,t,_){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=_||settings.RESOLUTION,this.resize(e,t)}return e.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},e.prototype.resize=function(e,t){this.canvas.width=e*this.resolution,this.canvas.height=t*this.resolution},e.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(e.prototype,"width",{get:function(){return this.canvas.width},set:function(e){this.canvas.width=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.canvas.height},set:function(e){this.canvas.height=e},enumerable:!1,configurable:!0}),e}(),CompressedTextureLoader=function(){function e(){}return e.use=function(t,_){var r=t.data;if(t.type===loaders.LoaderResource.TYPE.JSON&&r&&r.cacheID&&r.textures){for(var n=r.textures,o=void 0,s=void 0,a=0,R=n.length;a<R;a++){var i=n[a],T=i.src,E=i.format;if(E||(s=T),e.textureFormats[E]){o=T;break}}if(!(o=o||s))return void _(new Error("Cannot load compressed-textures in "+t.url+", make sure you provide a fallback"));if(o===t.url)return void _(new Error("URL of compressed texture cannot be the same as the manifest's URL"));var A={crossOrigin:t.crossOrigin,metadata:t.metadata.imageMetadata,parentResource:t},O=url.resolve(t.url.replace(this.baseUrl,""),o),S=r.cacheID;this.add(S,O,A,function(e){if(e.error)_(e.error);else{var r=e.texture,n=void 0===r?null:r,o=e.textures,s=void 0===o?{}:o;Object.assign(t,{texture:n,textures:s}),_()}})}else _()},e.add=function(){var t=document.createElement("canvas").getContext("webgl");if(t){var _={s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};for(var r in e.textureExtensions=_,e.textureFormats={},_){var n=_[r];n&&Object.assign(e.textureFormats,Object.getPrototypeOf(n))}}},e}();function registerCompressedTextures(e,t,_){var r={textures:{},texture:null};return t?(t.map(function(e){return new core.Texture(new core.BaseTexture(e,Object.assign({mipmap:constants.MIPMAP_MODES.OFF,alphaMode:constants.ALPHA_MODES.NO_PREMULTIPLIED_ALPHA},_)))}).forEach(function(t,_){var n=t.baseTexture,o=e+"-"+(_+1);core.BaseTexture.addToCache(n,o),core.Texture.addToCache(t,o),0===_&&(core.BaseTexture.addToCache(n,e),core.Texture.addToCache(t,e),r.texture=t),r.textures[o]=t}),r):r}loaders.LoaderResource.setExtensionXhrType("dds",loaders.LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var DXGI_FORMAT,D3D10_RESOURCE_DIMENSION,DDS_MAGIC_SIZE=4,DDS_HEADER_SIZE=124,DDS_HEADER_PF_SIZE=32,DDS_HEADER_DX10_SIZE=20,DDS_MAGIC=542327876,DDS_FIELDS={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},DDS_PF_FIELDS={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},DDS_DX10_FIELDS={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4};!function(e){e[e.DXGI_FORMAT_UNKNOWN=0]="DXGI_FORMAT_UNKNOWN",e[e.DXGI_FORMAT_R32G32B32A32_TYPELESS=1]="DXGI_FORMAT_R32G32B32A32_TYPELESS",e[e.DXGI_FORMAT_R32G32B32A32_FLOAT=2]="DXGI_FORMAT_R32G32B32A32_FLOAT",e[e.DXGI_FORMAT_R32G32B32A32_UINT=3]="DXGI_FORMAT_R32G32B32A32_UINT",e[e.DXGI_FORMAT_R32G32B32A32_SINT=4]="DXGI_FORMAT_R32G32B32A32_SINT",e[e.DXGI_FORMAT_R32G32B32_TYPELESS=5]="DXGI_FORMAT_R32G32B32_TYPELESS",e[e.DXGI_FORMAT_R32G32B32_FLOAT=6]="DXGI_FORMAT_R32G32B32_FLOAT",e[e.DXGI_FORMAT_R32G32B32_UINT=7]="DXGI_FORMAT_R32G32B32_UINT",e[e.DXGI_FORMAT_R32G32B32_SINT=8]="DXGI_FORMAT_R32G32B32_SINT",e[e.DXGI_FORMAT_R16G16B16A16_TYPELESS=9]="DXGI_FORMAT_R16G16B16A16_TYPELESS",e[e.DXGI_FORMAT_R16G16B16A16_FLOAT=10]="DXGI_FORMAT_R16G16B16A16_FLOAT",e[e.DXGI_FORMAT_R16G16B16A16_UNORM=11]="DXGI_FORMAT_R16G16B16A16_UNORM",e[e.DXGI_FORMAT_R16G16B16A16_UINT=12]="DXGI_FORMAT_R16G16B16A16_UINT",e[e.DXGI_FORMAT_R16G16B16A16_SNORM=13]="DXGI_FORMAT_R16G16B16A16_SNORM",e[e.DXGI_FORMAT_R16G16B16A16_SINT=14]="DXGI_FORMAT_R16G16B16A16_SINT",e[e.DXGI_FORMAT_R32G32_TYPELESS=15]="DXGI_FORMAT_R32G32_TYPELESS",e[e.DXGI_FORMAT_R32G32_FLOAT=16]="DXGI_FORMAT_R32G32_FLOAT",e[e.DXGI_FORMAT_R32G32_UINT=17]="DXGI_FORMAT_R32G32_UINT",e[e.DXGI_FORMAT_R32G32_SINT=18]="DXGI_FORMAT_R32G32_SINT",e[e.DXGI_FORMAT_R32G8X24_TYPELESS=19]="DXGI_FORMAT_R32G8X24_TYPELESS",e[e.DXGI_FORMAT_D32_FLOAT_S8X24_UINT=20]="DXGI_FORMAT_D32_FLOAT_S8X24_UINT",e[e.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS=21]="DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS",e[e.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT=22]="DXGI_FORMAT_X32_TYPELESS_G8X24_UINT",e[e.DXGI_FORMAT_R10G10B10A2_TYPELESS=23]="DXGI_FORMAT_R10G10B10A2_TYPELESS",e[e.DXGI_FORMAT_R10G10B10A2_UNORM=24]="DXGI_FORMAT_R10G10B10A2_UNORM",e[e.DXGI_FORMAT_R10G10B10A2_UINT=25]="DXGI_FORMAT_R10G10B10A2_UINT",e[e.DXGI_FORMAT_R11G11B10_FLOAT=26]="DXGI_FORMAT_R11G11B10_FLOAT",e[e.DXGI_FORMAT_R8G8B8A8_TYPELESS=27]="DXGI_FORMAT_R8G8B8A8_TYPELESS",e[e.DXGI_FORMAT_R8G8B8A8_UNORM=28]="DXGI_FORMAT_R8G8B8A8_UNORM",e[e.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB=29]="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB",e[e.DXGI_FORMAT_R8G8B8A8_UINT=30]="DXGI_FORMAT_R8G8B8A8_UINT",e[e.DXGI_FORMAT_R8G8B8A8_SNORM=31]="DXGI_FORMAT_R8G8B8A8_SNORM",e[e.DXGI_FORMAT_R8G8B8A8_SINT=32]="DXGI_FORMAT_R8G8B8A8_SINT",e[e.DXGI_FORMAT_R16G16_TYPELESS=33]="DXGI_FORMAT_R16G16_TYPELESS",e[e.DXGI_FORMAT_R16G16_FLOAT=34]="DXGI_FORMAT_R16G16_FLOAT",e[e.DXGI_FORMAT_R16G16_UNORM=35]="DXGI_FORMAT_R16G16_UNORM",e[e.DXGI_FORMAT_R16G16_UINT=36]="DXGI_FORMAT_R16G16_UINT",e[e.DXGI_FORMAT_R16G16_SNORM=37]="DXGI_FORMAT_R16G16_SNORM",e[e.DXGI_FORMAT_R16G16_SINT=38]="DXGI_FORMAT_R16G16_SINT",e[e.DXGI_FORMAT_R32_TYPELESS=39]="DXGI_FORMAT_R32_TYPELESS",e[e.DXGI_FORMAT_D32_FLOAT=40]="DXGI_FORMAT_D32_FLOAT",e[e.DXGI_FORMAT_R32_FLOAT=41]="DXGI_FORMAT_R32_FLOAT",e[e.DXGI_FORMAT_R32_UINT=42]="DXGI_FORMAT_R32_UINT",e[e.DXGI_FORMAT_R32_SINT=43]="DXGI_FORMAT_R32_SINT",e[e.DXGI_FORMAT_R24G8_TYPELESS=44]="DXGI_FORMAT_R24G8_TYPELESS",e[e.DXGI_FORMAT_D24_UNORM_S8_UINT=45]="DXGI_FORMAT_D24_UNORM_S8_UINT",e[e.DXGI_FORMAT_R24_UNORM_X8_TYPELESS=46]="DXGI_FORMAT_R24_UNORM_X8_TYPELESS",e[e.DXGI_FORMAT_X24_TYPELESS_G8_UINT=47]="DXGI_FORMAT_X24_TYPELESS_G8_UINT",e[e.DXGI_FORMAT_R8G8_TYPELESS=48]="DXGI_FORMAT_R8G8_TYPELESS",e[e.DXGI_FORMAT_R8G8_UNORM=49]="DXGI_FORMAT_R8G8_UNORM",e[e.DXGI_FORMAT_R8G8_UINT=50]="DXGI_FORMAT_R8G8_UINT",e[e.DXGI_FORMAT_R8G8_SNORM=51]="DXGI_FORMAT_R8G8_SNORM",e[e.DXGI_FORMAT_R8G8_SINT=52]="DXGI_FORMAT_R8G8_SINT",e[e.DXGI_FORMAT_R16_TYPELESS=53]="DXGI_FORMAT_R16_TYPELESS",e[e.DXGI_FORMAT_R16_FLOAT=54]="DXGI_FORMAT_R16_FLOAT",e[e.DXGI_FORMAT_D16_UNORM=55]="DXGI_FORMAT_D16_UNORM",e[e.DXGI_FORMAT_R16_UNORM=56]="DXGI_FORMAT_R16_UNORM",e[e.DXGI_FORMAT_R16_UINT=57]="DXGI_FORMAT_R16_UINT",e[e.DXGI_FORMAT_R16_SNORM=58]="DXGI_FORMAT_R16_SNORM",e[e.DXGI_FORMAT_R16_SINT=59]="DXGI_FORMAT_R16_SINT",e[e.DXGI_FORMAT_R8_TYPELESS=60]="DXGI_FORMAT_R8_TYPELESS",e[e.DXGI_FORMAT_R8_UNORM=61]="DXGI_FORMAT_R8_UNORM",e[e.DXGI_FORMAT_R8_UINT=62]="DXGI_FORMAT_R8_UINT",e[e.DXGI_FORMAT_R8_SNORM=63]="DXGI_FORMAT_R8_SNORM",e[e.DXGI_FORMAT_R8_SINT=64]="DXGI_FORMAT_R8_SINT",e[e.DXGI_FORMAT_A8_UNORM=65]="DXGI_FORMAT_A8_UNORM",e[e.DXGI_FORMAT_R1_UNORM=66]="DXGI_FORMAT_R1_UNORM",e[e.DXGI_FORMAT_R9G9B9E5_SHAREDEXP=67]="DXGI_FORMAT_R9G9B9E5_SHAREDEXP",e[e.DXGI_FORMAT_R8G8_B8G8_UNORM=68]="DXGI_FORMAT_R8G8_B8G8_UNORM",e[e.DXGI_FORMAT_G8R8_G8B8_UNORM=69]="DXGI_FORMAT_G8R8_G8B8_UNORM",e[e.DXGI_FORMAT_BC1_TYPELESS=70]="DXGI_FORMAT_BC1_TYPELESS",e[e.DXGI_FORMAT_BC1_UNORM=71]="DXGI_FORMAT_BC1_UNORM",e[e.DXGI_FORMAT_BC1_UNORM_SRGB=72]="DXGI_FORMAT_BC1_UNORM_SRGB",e[e.DXGI_FORMAT_BC2_TYPELESS=73]="DXGI_FORMAT_BC2_TYPELESS",e[e.DXGI_FORMAT_BC2_UNORM=74]="DXGI_FORMAT_BC2_UNORM",e[e.DXGI_FORMAT_BC2_UNORM_SRGB=75]="DXGI_FORMAT_BC2_UNORM_SRGB",e[e.DXGI_FORMAT_BC3_TYPELESS=76]="DXGI_FORMAT_BC3_TYPELESS",e[e.DXGI_FORMAT_BC3_UNORM=77]="DXGI_FORMAT_BC3_UNORM",e[e.DXGI_FORMAT_BC3_UNORM_SRGB=78]="DXGI_FORMAT_BC3_UNORM_SRGB",e[e.DXGI_FORMAT_BC4_TYPELESS=79]="DXGI_FORMAT_BC4_TYPELESS",e[e.DXGI_FORMAT_BC4_UNORM=80]="DXGI_FORMAT_BC4_UNORM",e[e.DXGI_FORMAT_BC4_SNORM=81]="DXGI_FORMAT_BC4_SNORM",e[e.DXGI_FORMAT_BC5_TYPELESS=82]="DXGI_FORMAT_BC5_TYPELESS",e[e.DXGI_FORMAT_BC5_UNORM=83]="DXGI_FORMAT_BC5_UNORM",e[e.DXGI_FORMAT_BC5_SNORM=84]="DXGI_FORMAT_BC5_SNORM",e[e.DXGI_FORMAT_B5G6R5_UNORM=85]="DXGI_FORMAT_B5G6R5_UNORM",e[e.DXGI_FORMAT_B5G5R5A1_UNORM=86]="DXGI_FORMAT_B5G5R5A1_UNORM",e[e.DXGI_FORMAT_B8G8R8A8_UNORM=87]="DXGI_FORMAT_B8G8R8A8_UNORM",e[e.DXGI_FORMAT_B8G8R8X8_UNORM=88]="DXGI_FORMAT_B8G8R8X8_UNORM",e[e.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM=89]="DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM",e[e.DXGI_FORMAT_B8G8R8A8_TYPELESS=90]="DXGI_FORMAT_B8G8R8A8_TYPELESS",e[e.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB=91]="DXGI_FORMAT_B8G8R8A8_UNORM_SRGB",e[e.DXGI_FORMAT_B8G8R8X8_TYPELESS=92]="DXGI_FORMAT_B8G8R8X8_TYPELESS",e[e.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB=93]="DXGI_FORMAT_B8G8R8X8_UNORM_SRGB",e[e.DXGI_FORMAT_BC6H_TYPELESS=94]="DXGI_FORMAT_BC6H_TYPELESS",e[e.DXGI_FORMAT_BC6H_UF16=95]="DXGI_FORMAT_BC6H_UF16",e[e.DXGI_FORMAT_BC6H_SF16=96]="DXGI_FORMAT_BC6H_SF16",e[e.DXGI_FORMAT_BC7_TYPELESS=97]="DXGI_FORMAT_BC7_TYPELESS",e[e.DXGI_FORMAT_BC7_UNORM=98]="DXGI_FORMAT_BC7_UNORM",e[e.DXGI_FORMAT_BC7_UNORM_SRGB=99]="DXGI_FORMAT_BC7_UNORM_SRGB",e[e.DXGI_FORMAT_AYUV=100]="DXGI_FORMAT_AYUV",e[e.DXGI_FORMAT_Y410=101]="DXGI_FORMAT_Y410",e[e.DXGI_FORMAT_Y416=102]="DXGI_FORMAT_Y416",e[e.DXGI_FORMAT_NV12=103]="DXGI_FORMAT_NV12",e[e.DXGI_FORMAT_P010=104]="DXGI_FORMAT_P010",e[e.DXGI_FORMAT_P016=105]="DXGI_FORMAT_P016",e[e.DXGI_FORMAT_420_OPAQUE=106]="DXGI_FORMAT_420_OPAQUE",e[e.DXGI_FORMAT_YUY2=107]="DXGI_FORMAT_YUY2",e[e.DXGI_FORMAT_Y210=108]="DXGI_FORMAT_Y210",e[e.DXGI_FORMAT_Y216=109]="DXGI_FORMAT_Y216",e[e.DXGI_FORMAT_NV11=110]="DXGI_FORMAT_NV11",e[e.DXGI_FORMAT_AI44=111]="DXGI_FORMAT_AI44",e[e.DXGI_FORMAT_IA44=112]="DXGI_FORMAT_IA44",e[e.DXGI_FORMAT_P8=113]="DXGI_FORMAT_P8",e[e.DXGI_FORMAT_A8P8=114]="DXGI_FORMAT_A8P8",e[e.DXGI_FORMAT_B4G4R4A4_UNORM=115]="DXGI_FORMAT_B4G4R4A4_UNORM",e[e.DXGI_FORMAT_P208=116]="DXGI_FORMAT_P208",e[e.DXGI_FORMAT_V208=117]="DXGI_FORMAT_V208",e[e.DXGI_FORMAT_V408=118]="DXGI_FORMAT_V408",e[e.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE=119]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE",e[e.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE=120]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE",e[e.DXGI_FORMAT_FORCE_UINT=121]="DXGI_FORMAT_FORCE_UINT"}(DXGI_FORMAT||(DXGI_FORMAT={})),function(e){e[e.DDS_DIMENSION_TEXTURE1D=2]="DDS_DIMENSION_TEXTURE1D",e[e.DDS_DIMENSION_TEXTURE2D=3]="DDS_DIMENSION_TEXTURE2D",e[e.DDS_DIMENSION_TEXTURE3D=6]="DDS_DIMENSION_TEXTURE3D"}(D3D10_RESOURCE_DIMENSION||(D3D10_RESOURCE_DIMENSION={}));var _a$2,_b$1,_c,PF_FLAGS=1,DDPF_ALPHA=2,DDPF_FOURCC=4,DDPF_RGB=64,DDPF_YUV=512,DDPF_LUMINANCE=131072,FOURCC_DXT1=827611204,FOURCC_DXT3=861165636,FOURCC_DXT5=894720068,FOURCC_DX10=808540228,DDS_RESOURCE_MISC_TEXTURECUBE=4,FOURCC_TO_FORMAT=((_a$1={})[FOURCC_DXT1]=exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_a$1[FOURCC_DXT3]=exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_a$1[FOURCC_DXT5]=exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_a$1),DXGI_TO_FORMAT=((_b={})[DXGI_FORMAT.DXGI_FORMAT_BC1_TYPELESS]=exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC1_UNORM]=exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC2_TYPELESS]=exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC2_UNORM]=exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC3_TYPELESS]=exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC3_UNORM]=exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC1_UNORM_SRGB]=exports.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC2_UNORM_SRGB]=exports.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC3_UNORM_SRGB]=exports.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,_b),DDSLoader=function(){function e(){}return e.use=function(t,_){if("dds"===t.extension&&t.data)try{Object.assign(t,registerCompressedTextures(t.name||t.url,e.parse(t.data),t.metadata))}catch(e){return void _(e)}_()},e.parse=function(e){var t=new Uint32Array(e);if(t[0]!==DDS_MAGIC)throw new Error("Invalid DDS file magic word");var _=new Uint32Array(e,0,DDS_HEADER_SIZE/Uint32Array.BYTES_PER_ELEMENT),r=_[DDS_FIELDS.HEIGHT],n=_[DDS_FIELDS.WIDTH],o=_[DDS_FIELDS.MIPMAP_COUNT],s=new Uint32Array(e,DDS_FIELDS.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,DDS_HEADER_PF_SIZE/Uint32Array.BYTES_PER_ELEMENT),a=s[PF_FLAGS];if(a&DDPF_FOURCC){var R=s[DDS_PF_FIELDS.FOURCC];if(R!==FOURCC_DX10){var i=FOURCC_TO_FORMAT[R],T=new Uint8Array(e,DDS_MAGIC_SIZE+DDS_HEADER_SIZE);return[new CompressedTextureResource(T,{format:i,width:n,height:r,levels:o})]}var E=DDS_MAGIC_SIZE+DDS_HEADER_SIZE,A=new Uint32Array(t.buffer,E,DDS_HEADER_DX10_SIZE/Uint32Array.BYTES_PER_ELEMENT),O=A[DDS_DX10_FIELDS.DXGI_FORMAT],S=A[DDS_DX10_FIELDS.RESOURCE_DIMENSION],h=A[DDS_DX10_FIELDS.MISC_FLAG],D=A[DDS_DX10_FIELDS.ARRAY_SIZE],M=DXGI_TO_FORMAT[O];if(void 0===M)throw new Error("DDSLoader cannot parse texture data with DXGI format "+O);if(h===DDS_RESOURCE_MISC_TEXTURECUBE)throw new Error("DDSLoader does not support cubemap textures");if(S===D3D10_RESOURCE_DIMENSION.DDS_DIMENSION_TEXTURE3D)throw new Error("DDSLoader does not supported 3D texture data");var l=new Array,u=DDS_MAGIC_SIZE+DDS_HEADER_SIZE+DDS_HEADER_DX10_SIZE;if(1===D)l.push(new Uint8Array(e,u));else{for(var I=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[M],c=0,G=n,p=r,f=0;f<o;f++){c+=Math.max(1,G+3&-4)*Math.max(1,p+3&-4)*I,G>>>=1,p>>>=1}var F=u;for(f=0;f<D;f++)l.push(new Uint8Array(e,F,c)),F+=c}return l.map(function(e){return new CompressedTextureResource(e,{format:M,width:n,height:r,levels:o})})}if(a&DDPF_RGB)throw new Error("DDSLoader does not support uncompressed texture data.");if(a&DDPF_YUV)throw new Error("DDSLoader does not supported YUV uncompressed texture data.");if(a&DDPF_LUMINANCE)throw new Error("DDSLoader does not support single-channel (lumninance) texture data!");if(a&DDPF_ALPHA)throw new Error("DDSLoader does not support single-channel (alpha) texture data!");throw new Error("DDSLoader failed to load a texture file due to an unknown reason!")},e}();loaders.LoaderResource.setExtensionXhrType("ktx",loaders.LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var FILE_IDENTIFIER=[171,75,84,88,32,49,49,187,13,10,26,10],ENDIANNESS=67305985,KTX_FIELDS={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},FILE_HEADER_SIZE=64,TYPES_TO_BYTES_PER_COMPONENT=((_a$2={})[constants.TYPES.UNSIGNED_BYTE]=1,_a$2[constants.TYPES.UNSIGNED_SHORT]=2,_a$2[constants.TYPES.FLOAT]=4,_a$2[constants.TYPES.HALF_FLOAT]=8,_a$2),FORMATS_TO_COMPONENTS=((_b$1={})[constants.FORMATS.RGBA]=4,_b$1[constants.FORMATS.RGB]=3,_b$1[constants.FORMATS.LUMINANCE]=1,_b$1[constants.FORMATS.LUMINANCE_ALPHA]=2,_b$1[constants.FORMATS.ALPHA]=1,_b$1),TYPES_TO_BYTES_PER_PIXEL=((_c={})[constants.TYPES.UNSIGNED_SHORT_4_4_4_4]=2,_c[constants.TYPES.UNSIGNED_SHORT_5_5_5_1]=2,_c[constants.TYPES.UNSIGNED_SHORT_5_6_5]=2,_c),KTXLoader=function(){function e(){}return e.use=function(t,_){if("ktx"===t.extension&&t.data)try{var r=t.name||t.url;Object.assign(t,registerCompressedTextures(r,e.parse(r,t.data),t.metadata))}catch(e){return void _(e)}_()},e.parse=function(t,_){var r=new DataView(_);if(!e.validate(t,r))return null;var n=r.getUint32(KTX_FIELDS.ENDIANNESS,!0)===ENDIANNESS,o=r.getUint32(KTX_FIELDS.GL_TYPE,n),s=r.getUint32(KTX_FIELDS.GL_FORMAT,n),a=r.getUint32(KTX_FIELDS.GL_INTERNAL_FORMAT,n),R=r.getUint32(KTX_FIELDS.PIXEL_WIDTH,n),i=r.getUint32(KTX_FIELDS.PIXEL_HEIGHT,n)||1,T=r.getUint32(KTX_FIELDS.PIXEL_DEPTH,n)||1,E=r.getUint32(KTX_FIELDS.NUMBER_OF_ARRAY_ELEMENTS,n)||1,A=r.getUint32(KTX_FIELDS.NUMBER_OF_FACES,n),O=r.getUint32(KTX_FIELDS.NUMBER_OF_MIPMAP_LEVELS,n),S=r.getUint32(KTX_FIELDS.BYTES_OF_KEY_VALUE_DATA,n);if(0===i||1!==T)throw new Error("Only 2D textures are supported");if(1!==A)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==E)throw new Error("WebGL does not support array textures");var h,D=R+3&-4,M=i+3&-4,l=new Array(E),u=R*i;if(0===o&&(u=D*M),void 0===(h=0!==o?TYPES_TO_BYTES_PER_COMPONENT[o]?TYPES_TO_BYTES_PER_COMPONENT[o]*FORMATS_TO_COMPONENTS[s]:TYPES_TO_BYTES_PER_PIXEL[o]:INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[a]))throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");for(var I=u*h,c=R,G=i,p=D,f=M,F=FILE_HEADER_SIZE+S,P=0;P<O;P++){for(var X=r.getUint32(F,n),N=F+4,C=0;C<E;C++){var d=l[C];d||(d=l[C]=new Array(O)),d[P]={levelID:P,levelWidth:O>1?c:p,levelHeight:O>1?G:f,levelBuffer:new Uint8Array(_,N,I)},N+=I}F=(F+=X+4)%4!=0?F+4-F%4:F,I=(p=(c=c>>1||1)+4-1&-4)*(f=(G=G>>1||1)+4-1&-4)*h}if(0!==o)throw new Error("TODO: Uncompressed");return l.map(function(e){return new CompressedTextureResource(null,{format:a,width:R,height:i,levels:O,levelBuffers:e})})},e.validate=function(e,t){for(var _=0;_<FILE_IDENTIFIER.length;_++)if(t.getUint8(_)!==FILE_IDENTIFIER[_])return!1;return!0},e}();exports.BlobResource=BlobResource,exports.CompressedTextureLoader=CompressedTextureLoader,exports.CompressedTextureResource=CompressedTextureResource,exports.DDSLoader=DDSLoader,exports.FORMATS_TO_COMPONENTS=FORMATS_TO_COMPONENTS,exports.INTERNAL_FORMAT_TO_BYTES_PER_PIXEL=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL,exports.KTXLoader=KTXLoader,exports.TYPES_TO_BYTES_PER_COMPONENT=TYPES_TO_BYTES_PER_COMPONENT,exports.TYPES_TO_BYTES_PER_PIXEL=TYPES_TO_BYTES_PER_PIXEL;
//# sourceMappingURL=compressed-textures.min.js.map
